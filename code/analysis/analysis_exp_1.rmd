```{r}
library("emmeans")     # for linear contrasts
library("tidybayes")   # tidying up results from Bayesian models
library("brms")        # Bayesian regression models with Stan
library("tidyverse")   # for wrangling, plotting, etc. 
library("dplyr")
```

```{r}

df.exp_1 = read_csv("../../data/results/model_results_long.csv")

df.exp_1 = df.exp_1[df.exp_1$model == "gpt-4-0613" & df.exp_1$method == "0shot",]


# predict kant vs
head(df.exp_1)

```
```{r}
# main regression
fit.brm_exp_1= brm(formula = permissibility_rating ~ 1 + causal_structure + evitability + action + (1 | scenario_id),
                      data = df.exp_1,
                      seed = 1)
```

```{r}
fit.brm_exp_1 %>% 
  summary()
```
```{r}
# contrasts
emm = fit.brm_exp_1 %>% 
  emmeans(specs = pairwise ~ action,
          type = "response")
emm
```

```{r}
# contrasts
df.data = df.exp_1 %>%
  group_by(scenario_id, harm, good, causal_structure, evitability, action) %>% 
  summarize(mean = mean(permissibility_rating))

df.model = df.exp_1 %>% 
              distinct(scenario_id, harm, good, causal_structure, evitability, action)

df.model

# write to csv 
getwd()
write.csv(df.data, 'permissibility_human.csv')
write.csv(df.model, 'permissibility_human_predicted.csv')

df.predicted = fit.brm_exp_1 %>% 
  fitted(df.model,
         re_formula = NA)

write.csv(df.predicted, 'permissibility_human_predicted.csv')

```